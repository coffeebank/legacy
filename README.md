See legacy branch for code
